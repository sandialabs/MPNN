#!/usr/bin/env python

import sys
import numpy as np

from mpnn.utils_mpnn import  MPoint, Rhombus
from mpnn.utils_gen import savepk, loadpk

# tags = loadpk('tags')
# print(tags)
# np.savetxt('tags.txt', np.array(tags, dtype=object), fmt='%s')
# sys.exit()

caseid = int(sys.argv[1])
#1 for H pbe-d3(abc), 2 for H beef, 3 for CO, 4 for CH3OH, 5 for CH3OH_3d, 6 for CH3, 7 for HXCO, 8 for HXCOt

if caseid == 1:
    # fcc:
    center = np.array([1.26572824, 0.73075499, 0.91748354])
    hess = np.array([[2.73218277e+00, 8.99886106e-05, -2.44254800e-03],
                      [8.99886106e-05, 2.73219563e+00, -7.13481127e-04],
                      [-2.44254800e-03, -7.13481127e-04, 4.14538963e+00]])
    yshift = 0.0
    pt1 = MPoint(center, hess, yshift)

    # hcp:
    center = np.array([2.53145314, 1.4615272, 0.91993214])
    hess = np.array([[2.68536299e+00, -2.57110316e-05, -5.14220632e-05],
                      [-2.57110316e-05, 2.68522158e+00, 2.05688253e-04],
                      [-5.14220632e-05, 2.05688253e-04, 4.16232034e+00]])
    yshift = 0.000466675235657
    pt2 = MPoint(center, hess, yshift)

    mpts = [pt1, pt2]

elif caseid == 2:
    center = np.array([1.29399834, 0.74710724, 0.91696773])
    hess =  np.array([[ 1.6849596, 0.00408805, -0.00514221],
     [ 0.00408805, 1.68520386, 0.05403173],
     [-0.00514221, 0.05403173, 3.08849911]])
    yshift = 0.0
    pt1 = MPoint(center, hess, yshift)

    center = np.array([2.58798492, 1.49419989, 0.92222111])
    hess = np.array([[ 1.72841124e+00, -1.01365742e-02, -7.82065304e-02],
     [-1.01365742e-02, 1.70989930e+00, -2.56467540e-03],
     [-7.82065304e-02, -2.56467540e-03, 3.22044812e+00]])
    yshift = 0.000833212572616
    pt2 = MPoint(center, hess, yshift)

    mpts = [pt1, pt2]

elif caseid == 3:
    center = np.array([1.394358, 0.8050345, 2.049088,  0.000000,  0.000000])
    hess =  np.array([[ 2.85668992e+00, -1.46261300e-02, -1.97281770e-02,  1.19050674e-02, -1.39186232e+00],
 [-1.46261300e-02,  2.87324234e+00, -1.22450001e-02, -1.40478762e+00,  1.12247653e-02],
 [-1.97281770e-02, -1.22450001e-02,  1.33344332e+01,  1.36057497e-02,  2.38099892e-02],
 [ 1.19050674e-02, -1.40478762e+00,  1.36057497e-02,  7.06799086e+00, -9.86401574e-03],
 [-1.39186232e+00,  1.12247653e-02,  2.38099892e-02, -9.86401574e-03,  7.05529266e+00]])
    yshift = 0.0
    pt1 = MPoint(center, hess, yshift)

    center = np.array([2.786752, 1.6089370,  2.047703,  0.000000,  0.000000])
    hess = np.array([[ 3.03690637e+00, 9.18385922e-03, -1.25852239e-02, -6.46147743e-03, -1.56399514e+00],
 [ 9.18385922e-03,  3.02715537e+00, -5.44212526e-03, -1.55787367e+00, -7.48164945e-03],
 [-1.25852239e-02, -5.44212526e-03,  1.32950312e+01,  6.12117761e-03,  1.36031180e-02],
 [-6.46147743e-03, -1.55787367e+00,  6.12117761e-03,  7.25374952e+00,  5.78013420e-03],
 [-1.56399514e+00, -7.48164945e-03,  1.36031180e-02,  5.78013420e-03,  7.25907563e+00]])
    yshift = 0.0285314081702
    pt2 = MPoint(center, hess, yshift)

    center = np.array([4.176158, 2.4121032,  2.529968,  0.000000,  0.000000])
    hess = np.array([[ 1.12589085e+00, 2.38098437e-03, -3.50346090e-02, -1.40960954e-07,  2.79504485e+00],
 [ 2.38098437e-03,  1.11636662e+00,  3.40136467e-03, -2.79109103e+00,  2.63611081e-03],
 [-3.50346090e-02,  3.40136467e-03,  2.23982771e+01,  6.58992461e-04, -1.97683642e-03],
 [-1.40960954e-07, -2.79109103e+00,  6.58992461e-04,  9.35863363e+00, -1.59594422e-03],
 [ 2.79504485e+00,  2.63611081e-03, -1.97683642e-03, -1.59594422e-03,  9.36799615e+00]])
    yshift = 0.142956093652
    pt3 = MPoint(center, hess, yshift)

    mpts = [pt1, pt2, pt3]


elif caseid == 4:
    center = np.array([2.173805, 0.316083, 2.701504,  0.000000,  0.000000,  0.000000])
    #center = np.array([0.0, 0.0, 2.701504,  0.000000,  0.000000,  0.000000])
    hess =  np.array([[ 0.68629409,  0.03231355, -0.00204083,  0.10272299, -0.3136112,   0.27211383],
                      [ 0.03231355,  0.49978253,  0.10068208,  0.09489973,  0.07959323,  0.10034197],
                      [-0.00204083,  0.10068208,  1.72452169,  0.20986783, -0.30102594,  0.25034478],
                      [ 0.10272299,  0.09489973,  0.20986783,  0.25023154, -0.07040944,  0.20680654],
                      [-0.3136112,   0.07959323, -0.30102594, -0.07040944,  0.82824674, -0.3343599 ],
                      [ 0.27211383,  0.10034197,  0.25034478,  0.20680654, -0.3343599,   0.39728619]])
    yshift = 0.0
    pt1 = MPoint(center, hess, yshift)


    mpts = [pt1]

elif caseid == 5:
    center_ = np.array([2.173805, 0.316083, 2.701504,  0.000000,  0.000000,  0.000000])
    hess_ =  np.array([[ 0.68629409,  0.03231355, -0.00204083,  0.10272299, -0.3136112,   0.27211383],
                      [ 0.03231355,  0.49978253,  0.10068208,  0.09489973,  0.07959323,  0.10034197],
                      [-0.00204083,  0.10068208,  1.72452169,  0.20986783, -0.30102594,  0.25034478],
                      [ 0.10272299,  0.09489973,  0.20986783,  0.25023154, -0.07040944,  0.20680654],
                      [-0.3136112,   0.07959323, -0.30102594, -0.07040944,  0.82824674, -0.3343599 ],
                      [ 0.27211383,  0.10034197,  0.25034478,  0.20680654, -0.3343599,   0.39728619]])
    center = center_[:3]
    hess = np.linalg.inv(np.linalg.inv(hess_)[:3,:3])
    yshift = 0.0
    pt1 = MPoint(center, hess, yshift)
    mpts = [pt1]


elif caseid == 6:
    center = np.array([1.23483075, 0.71293564, 1.62122541,  0.000000,  0.000000, 0.000000])
    hess =  np.array([[ 3.43180904e+00,  5.44230716e-03, -3.70755515e-02, -2.23621002e-01,  -3.85042782e-01,  9.99632036e-03], \
                     [ 5.44230716e-03,  3.43158260e+00, -4.76196874e-03,  3.73935773e-01,  -2.17326952e-01,  2.07330473e-02], \
                     [-3.70755515e-02, -4.76196874e-03,  8.55457884e+00, -1.33284272e-02,  -1.48093195e-03, -1.22176985e-02], \
                     [-2.23621002e-01,  3.73935773e-01, -1.33284272e-02,  2.11756009e+00,   1.20899061e-03,  8.46267565e-03], \
                     [-3.85042782e-01, -2.17326952e-01, -1.48093195e-03,  1.20899061e-03,   2.09620172e+00, -1.00746631e-02], \
                     [ 9.99632036e-03,  2.07330473e-02, -1.22176985e-02,  8.46267565e-03,  -1.00746631e-02,  2.02849990e+00]])
    yshift = 0.0
    pt1 = MPoint(center, hess, yshift)

    center = np.array([2.46722694, 1.42435957,  1.64558676,  0.000000,  0.000000, np.pi/3.0])
    hess = np.array([[ 2.83021086e+00,  2.04083335e-03,  1.12246562e-02, -3.55794307e-01,  -6.66425317e-03, -7.40446176e-04], \
                    [ 2.04083335e-03,  2.84823840e+00,  3.29938121e-02,  8.51538841e-03,  -3.49130093e-01, -1.85117484e-03], \
                    [ 1.12246562e-02,  3.29938121e-02,  6.92155595e+00, -2.07330473e-02,  -1.96224374e-02,  3.33218598e-03], \
                    [-3.55794307e-01,  8.51538841e-03, -2.07330473e-02,  2.04851532e+00,   1.20899061e-03,  4.03039970e-04], \
                    [-6.66425317e-03, -3.49130093e-01, -1.96224374e-02,  1.20899061e-03,   2.01761970e+00,  1.61194438e-03], \
                    [-7.40446176e-04, -1.85117484e-03,  3.33218598e-03,  4.03039970e-04,   1.61194438e-03,  1.93420106e+00]])
    yshift = 0.03961446867
    pt2 = MPoint(center, hess, yshift)


    mpts = [pt1, pt2]


elif caseid == 7:
    center = np.array([1.21863862e+00, 9.45365671e-01, 1.77857035e+01, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00])
    hess =  np.loadtxt('../H_rigid_fcc.dat')
    yshift = 3.93570490e-02
    pt1 = MPoint(center, hess, yshift)


    center = np.array([2.47409374e+00, 1.25369103e+00, 1.77841116e+01, 4.85671002e-02, 5.98602723e-01, 1.39853043e-01])
    hess =  np.loadtxt('../H_rigid_hcp.dat')

    yshift = 0.0
    pt2 = MPoint(center, hess, yshift)

    center = np.array([3.06283153e+00, 1.03581579e+00, 1.80108224e+01, 1.81302028e-01, 9.13705592e-02, 1.08318293e+00])

    hess =  np.loadtxt('../H_rigid_atop.dat')

    yshift = 2.17254328e-02
    pt3 = MPoint(center, hess, yshift)

    mpts = [pt1, pt2, pt3]


elif caseid == 8:
    center = np.array([1.20863991e-01, -1.50931811e-01, -1.00530753e+00, -8.91946840e+00, 1.51421991e+01])
    #center = np.array([1.43795995e-01, -1.52019078e-01, -1.00698990e+00, -8.92334909e+00, 1.51413437e+01])
    hess =  np.loadtxt('../H_s_5x5.dat')
    yshift = 4.87083889e-05
    pt1 = MPoint(center, hess, yshift)


    mpts = [pt1]

else:
    print('Case id should be 1 to 8')
    sys.exit()


for pt in mpts:
    evals, _ = np.linalg.eigh(pt.hess)
    print(pt, evals)


if caseid == 1:
    zmin, zmax = 0.41748, 4.41748  # 4.41358
    delta_x = 7.594326829943521 / 3.
    pnames=['x', 'y', 'z']
elif caseid == 2:
    zmin, zmax = 0.41696773, 5.16696773
    delta_x = 3.88201623 * 2. / 3.
    pnames=['x', 'y', 'z']
elif caseid == 3:
    zmin, zmax = 1.54908781, 3.5 # 6.54908781
    delta_x = 2.78600072
    pnames=['x', 'y', 'z', r'$\alpha r$', r'$\beta r$']
elif caseid == 4:
    zmin, zmax = 1.451504, 4.5 # 7.701504
    delta_x = 2.531442
    pnames=['x', 'y', 'z', r'$\alpha$', r'$\beta$', r'$\gamma$']
    # Atop is at 2.173805, 0.316083, 2.701504
elif caseid == 5:
    zmin, zmax = 2.7, 2.8 #2.701504, 2.701504
    delta_x = 2.531442
    pnames=['x', 'y', 'z']
    # Atop is at 2.173805, 0.316083, 2.701504
elif caseid == 6:
    zmin, zmax = 0.87122541, 4.12122541
    delta_x = 2.4678027
    pnames=['x', 'y', 'z', r'$\alpha$', r'$\beta$', r'$\gamma$']
elif caseid == 7:
    zmin, zmax = 17.284111598837722, 20.010822411647094
    delta_x = 2.5
    pnames=['x', 'y', 'z', r'$\alpha$', r'$\beta$', r'$\gamma$']
elif caseid == 8:
    zmin, zmax = 0.0, 20.0
    delta_x = 12.5
    pnames=['s1', 's2', 's3', 's4', 's5']

else:
    print("Case id unknown")
    sys.exit()

case_glob = {'mpts': mpts, 'zmin': zmin, 'zmax': zmax, 'delta_x': delta_x, 'pnames': pnames}
savepk(case_glob,'case_glob')
